(function(e){function t(t){for(var a,o,s=t[0],l=t[1],c=t[2],u=0,p=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&p.push(n[o][0]),n[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);m&&m(t);while(p.length)p.shift()();return i.push.apply(i,c||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],a=!0,o=1;o<r.length;o++){var l=r[o];0!==n[l]&&(a=!1)}a&&(i.splice(t--,1),e=s(s.s=r[0]))}return e}var a={},n={app:0},i=[];function o(e){return s.p+"js/"+({about:"about"}[e]||e)+"."+{about:"af831328"}[e]+".js"}function s(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.e=function(e){var t=[],r=n[e];if(0!==r)if(r)t.push(r[2]);else{var a=new Promise((function(t,a){r=n[e]=[t,a]}));t.push(r[2]=a);var i,l=document.createElement("script");l.charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.src=o(e);var c=new Error;i=function(t){l.onerror=l.onload=null,clearTimeout(u);var r=n[e];if(0!==r){if(r){var a=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+a+": "+i+")",c.name="ChunkLoadError",c.type=a,c.request=i,r[1](c)}n[e]=void 0}};var u=setTimeout((function(){i({type:"timeout",target:l})}),12e4);l.onerror=l.onload=i,document.head.appendChild(l)}return Promise.all(t)},s.m=e,s.c=a,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(r,a,function(t){return e[t]}.bind(null,a));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/vrm-avatar-editor/",s.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],c=l.push.bind(l);l.push=t,l=l.slice();for(var u=0;u<l.length;u++)t(l[u]);var m=c;i.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("cd49")},"0bc1":function(e,t,r){},"2d59":function(e,t,r){"use strict";r("5898")},5021:function(e,t,r){"use strict";r("a352")},5898:function(e,t,r){},"5ced":function(e,t,r){},6978:function(e,t,r){},"9b19":function(e,t,r){e.exports=r.p+"img/logo.63a7d78d.svg"},"9dd2":function(e,t,r){"use strict";r("6978")},a352:function(e,t,r){},cccb:function(e,t,r){"use strict";r("5ced")},cd49:function(e,t,r){"use strict";r.r(t);var a=r("2b0e"),n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",[r("v-main",[r("router-view")],1)],1)},i=[],o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("v-row",{staticClass:"text-center"},[a("v-col",{attrs:{cols:"12"}},[a("v-img",{staticClass:"my-3",attrs:{src:r("9b19"),contain:"",height:"200"}})],1),a("v-col",{staticClass:"mb-4"},[a("h1",{staticClass:"display-2 font-weight-bold mb-3"},[e._v("Welcome to Vuetify")]),a("p",{staticClass:"subheading font-weight-regular"},[e._v(" For help and collaboration with other Vuetify developers, "),a("br"),e._v("please join our online "),a("a",{attrs:{href:"https://community.vuetifyjs.com",target:"_blank"}},[e._v("Discord Community")])])]),a("v-col",{staticClass:"mb-5",attrs:{cols:"12"}},[a("h2",{staticClass:"headline font-weight-bold mb-3"},[e._v("What's next?")]),a("v-row",{attrs:{justify:"center"}},e._l(e.whatsNext,(function(t,r){return a("a",{key:r,staticClass:"subheading mx-3",attrs:{href:t.href,target:"_blank"}},[e._v(" "+e._s(t.text)+" ")])})),0)],1),a("v-col",{staticClass:"mb-5",attrs:{cols:"12"}},[a("h2",{staticClass:"headline font-weight-bold mb-3"},[e._v("Important Links")]),a("v-row",{attrs:{justify:"center"}},e._l(e.importantLinks,(function(t,r){return a("a",{key:r,staticClass:"subheading mx-3",attrs:{href:t.href,target:"_blank"}},[e._v(" "+e._s(t.text)+" ")])})),0)],1),a("v-col",{staticClass:"mb-5",attrs:{cols:"12"}},[a("h2",{staticClass:"headline font-weight-bold mb-3"},[e._v("Ecosystem")]),a("v-row",{attrs:{justify:"center"}},e._l(e.ecosystem,(function(t,r){return a("a",{key:r,staticClass:"subheading mx-3",attrs:{href:t.href,target:"_blank"}},[e._v(" "+e._s(t.text)+" ")])})),0)],1)],1)],1)},s=[],l=a["a"].extend({name:"HelloWorld",data:()=>({ecosystem:[{text:"vuetify-loader",href:"https://github.com/vuetifyjs/vuetify-loader"},{text:"github",href:"https://github.com/vuetifyjs/vuetify"},{text:"awesome-vuetify",href:"https://github.com/vuetifyjs/awesome-vuetify"}],importantLinks:[{text:"Documentation",href:"https://vuetifyjs.com"},{text:"Chat",href:"https://community.vuetifyjs.com"},{text:"Made with Vuetify",href:"https://madewithvuejs.com/vuetify"},{text:"Twitter",href:"https://twitter.com/vuetifyjs"},{text:"Articles",href:"https://medium.com/vuetify"}],whatsNext:[{text:"Explore components",href:"https://vuetifyjs.com/components/api-explorer"},{text:"Select a layout",href:"https://vuetifyjs.com/getting-started/pre-made-layouts"},{text:"Frequently Asked Questions",href:"https://vuetifyjs.com/getting-started/frequently-asked-questions"}]})}),c=l,u=r("2877"),m=r("6544"),p=r.n(m),d=r("62ad"),h=r("a523"),f=r("adda"),v=r("0fd9"),g=Object(u["a"])(c,o,s,!1,null,null,null),b=g.exports;p()(g,{VCol:d["a"],VContainer:h["a"],VImg:f["a"],VRow:v["a"]});var y=a["a"].extend({name:"App",components:{HelloWorld:b},data:()=>({})}),O=y,_=r("7496"),w=r("f6c4"),x=Object(u["a"])(O,n,i,!1,null,null,null),j=x.exports;p()(x,{VApp:_["a"],VMain:w["a"]});var I=r("8c4f"),N=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"home full"},[r("v-app-bar",{attrs:{danse:"",dark:"",id:"app-bar"}},[r("v-toolbar-title",[e._v("VRM Avatar Editor")]),r("v-spacer"),r("v-btn",{attrs:{href:"https://github.com/gatosyocora/vrm-avatar-editor/issues/new",target:"_blank"}},[e._v("Issue")]),r("v-btn",{attrs:{href:"https://github.com/gatosyocora/vrm-avatar-editor",target:"_blank"}},[e._v("GitHub")]),r("v-btn",{attrs:{href:"https://github.com/gatosyocora/vrm-avatar-editor/blob/master/README.md",target:"_blank"}},[e._v("License")]),r("v-btn",{attrs:{icon:""},on:{click:e.reloadPage}},[r("v-icon",[e._v("mdi-cached")])],1)],1),r("p",{attrs:{id:"message"}},[e._v(" ローカル環境で処理しているため、VRMファイルをサーバーにアップロードしていません。 ")]),r("div",{staticClass:"full-height",attrs:{id:"menu"}},[r("v-card",{staticClass:"full-height"},[r("v-tabs",{attrs:{"fixed-tabs":"",dark:""}},[r("v-tab",{class:{active:0===e.currentTab},on:{click:function(t){return e.changeTab(0)}}},[e._v("Meta")]),r("v-tab",{class:{active:1===e.currentTab},on:{click:function(t){return e.changeTab(1)}}},[e._v("Materials")]),r("v-tab",{class:{active:2===e.currentTab},on:{click:function(t){return e.changeTab(2)}}},[e._v("Model")])],1),r("div",{staticClass:"margin-area contents"},[r("div",{directives:[{name:"show",rawName:"v-show",value:0===e.currentTab,expression:"currentTab === 0"}]},[r("MetaView",{attrs:{meta:e.meta,exporterVersion:e.exporterVersion}})],1),r("div",{directives:[{name:"show",rawName:"v-show",value:1===e.currentTab,expression:"currentTab === 1"}]},[r("MaterialView",{attrs:{materials:e.materials}})],1),r("div",{directives:[{name:"show",rawName:"v-show",value:2===e.currentTab,expression:"currentTab === 2"}]},[r("ModelInfoView",{attrs:{vrmObject:e.vrmObject,materials:e.materials}})],1),r("ExportButton",{attrs:{vrm:e.vrm}})],1)],1)],1),r("div",{staticClass:"full",attrs:{id:"main"}},[r("div",{staticClass:"top full"},[null===e.vrmObject?r("DragAndDroppableArea",{staticClass:"layer2 layer full",on:{onDropFile:e.loadVrm}},[r("div",{staticClass:"white-color"},[r("center",[e._v(" VRMをドラッグ&ドロップ"),r("br"),r("p",[r("input",{attrs:{type:"file",accept:".vrm"},on:{change:e.onFileChange}})])])],1)]):e._e(),r("VRMCanvas",{staticClass:"layer1 layer full",attrs:{vrmObject:e.vrmObject}})],1)])],1)},E=[],S=r("9ab4"),T=r("60a3"),M=r("34ad"),A=r("f7e7"),D=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("canvas",{attrs:{id:"canvas"}})},B=[],V=r("5a89"),R=r("4721");let C=class extends T["e"]{constructor(){super(...arguments),this.scene=null,this.renderer=null,this.camera=new V["PerspectiveCamera"](75,window.innerWidth/window.innerHeight,.1,1e3),this.light=new V["DirectionalLight"](16777215,2),this.gridHelper=new V["GridHelper"](10,10),this.axesHelper=new V["AxesHelper"](5),this.controls=null}mounted(){const e=document.getElementById("canvas");null!==e&&(e.width=window.innerWidth,e.height=window.innerHeight,this.renderer=new V["WebGLRenderer"]({antialias:!0,canvas:e}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.camera.position.set(0,1,-1.5),this.camera.rotation.set(0,Math.PI,0),this.controls=new R["a"](this.camera,this.renderer.domElement),this.controls.screenSpacePanning=!0,this.controls.target.set(0,1,0),this.controls.update(),this.light.position.set(0,0,-10),this.initScene())}animate(){this.scene&&(requestAnimationFrame(this.animate),this.renderer.render(this.scene,this.camera))}updateVrm(e){this.scene&&(this.vrmObject&&this.initScene(),this.vrmObject=e,null!==e&&this.scene.add(this.vrmObject))}initScene(){this.scene=new V["Scene"],this.scene.add(this.light),this.scene.add(this.gridHelper),this.scene.add(this.axesHelper),this.animate()}};Object(S["a"])([Object(T["d"])("scene")],C.prototype,"scene",void 0),Object(S["a"])([Object(T["c"])()],C.prototype,"meta",void 0),Object(S["a"])([Object(T["c"])()],C.prototype,"materials",void 0),Object(S["a"])([Object(T["c"])()],C.prototype,"vrmObject",void 0),Object(S["a"])([Object(T["f"])("vrmObject",{immediate:!0})],C.prototype,"updateVrm",null),C=Object(S["a"])([T["a"]],C);var L=C,U=L,P=Object(u["a"])(U,D,B,!1,null,null,null),k=P.exports,G=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.meta?r("div",[r("v-simple-table",[r("tbody",[r("tr",[r("td",[e._v("Title")]),r("td",[e._v(e._s(e.meta.title))])]),r("tr",[r("td",[e._v("Version")]),r("td",[e._v(e._s(e.meta.version))])]),r("tr",[r("td",[e._v("Author")]),r("td",[e._v(e._s(e.meta.author))])]),r("tr",[r("td",[e._v("AllowUser")]),r("td",[e._v(e._s(e.meta.allowedUserName))])]),r("tr",[r("td",[e._v("CommercialUssage")]),r("td",[e._v(e._s(e.meta.commercialUssageName))])]),r("tr",[r("td",[e._v("SexualUssage")]),r("td",[e._v(e._s(e.meta.sexualUssageName))])]),r("tr",[r("td",[e._v("ViolentUssage")]),r("td",[e._v(e._s(e.meta.violentUssageName))])]),r("tr",[r("td",[e._v("LicenseName")]),r("td",[e._v(e._s(e.meta.licenseName))])]),r("tr",[r("td",[e._v("OtherLicense")]),r("td",[r("a",{attrs:{href:e.meta.otherLicenseUrl,target:"_blank"}},[e._v(" "+e._s(e.meta.otherLicenseUrl)+" ")])])]),r("tr",[r("td",[e._v("OtherPermission")]),r("td",[r("a",{attrs:{href:e.meta.otherPermissionUrl,target:"_blank"}},[e._v(" "+e._s(e.meta.otherPermissionUrl)+" ")])])]),r("tr",[r("td",[e._v("ContactInformation")]),r("td",[r("a",{attrs:{href:e.meta.contactInformation,target:"_blank"}},[e._v(" "+e._s(e.meta.contactInformation)+" ")])])]),r("tr",[r("td",[e._v("Reference")]),r("td",[e._v(e._s(e.meta.reference))])]),r("tr",[r("td",[e._v("Icon")]),r("td",[r("DragAndDroppableArea",{on:{onDropFile:e.changeIconFile}},[r("ImageBitmapImg",{attrs:{imageBitmap:e.meta.texture?e.meta.texture.image:void 0,showInfo:!1}})],1)],1)]),r("tr",[r("td",[e._v("ExporterVersion")]),r("td",[e._v(e._s(e.exporterVersion))])])])])],1):e._e()},F=[],H=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{margin:"0 10px 0 10px"}},[r("v-hover",{scopedSlots:e._u([{key:"default",fn:function(t){var a=t.hover;return[r("v-list-item-avatar",{attrs:{rounded:"",size:"80",color:"white"}},[e.imageBitmap?r("v-img",{attrs:{src:e.convertImageBitmap2Base64(e.imageBitmap)}},[e.showInfo&&a?r("div",{staticClass:"tex-info unselectable"},[e._v(" "+e._s(e.imageBitmap.width)+"x"+e._s(e.imageBitmap.height)+" ")]):e._e()]):r("span",{staticStyle:{color:"black"}},[e._v(" none ")])],1)]}}])})],1)},z=[];let q=class extends T["e"]{convertImageBitmap2Base64(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL()}};Object(S["a"])([Object(T["c"])()],q.prototype,"imageBitmap",void 0),Object(S["a"])([Object(T["c"])({default:!0})],q.prototype,"showInfo",void 0),q=Object(S["a"])([T["a"]],q);var X=q,W=X,Y=(r("5021"),r("ce87")),K=r("8270"),$=Object(u["a"])(W,H,z,!1,null,null,null),J=$.exports;p()($,{VHover:Y["a"],VImg:f["a"],VListItemAvatar:K["a"]});var Q=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{class:{outline:e.isDragOver},on:{dragover:function(t){return t.preventDefault(),e.onDrag("over")},dragleave:function(t){return t.preventDefault(),e.onDrag("leave")},drop:function(t){return t.preventDefault(),e.onDrop(t)}}},[e._t("default")],2)},Z=[];let ee=class extends T["e"]{onDrag(e){this.isDragOver="over"===e}onDrop(e){if(null===e.dataTransfer||null===e.dataTransfer.files)return;this.isDragOver=!1;const t=e.dataTransfer.files[0],r=window.URL.createObjectURL(t);this.$emit("onDropFile",r)}};Object(S["a"])([Object(T["c"])({default:!1})],ee.prototype,"isDragOver",void 0),ee=Object(S["a"])([T["a"]],ee);var te=ee,re=te,ae=(r("2d59"),Object(u["a"])(re,Q,Z,!1,null,null,null)),ne=ae.exports;let ie=class extends T["e"]{getMeshCount(e){return e.filter(e=>["Group","SkinnedMesh"].includes(e.type)).length}getPolygonCount(e){return e.filter(e=>["Group","SkinnedMesh","Object3D"].includes(e.type)).map(e=>["Group","Object3D"].includes(e.type)?e.children.length<=0?0:e.children.map(e=>e.geometry.groups[0].count).reduce((e,t)=>e+t,0):"SkinnedMesh"===e.type?e.geometry.groups[0].count:e.children.map(e=>e.geometry.groups[0].count).reduce((e,t)=>e+t,0)).reduce((e,t)=>e+t,0)/3}getBlendShapeCount(e){let t=0;return e.forEach(e=>{"Group"===e.type&&(t+=e.children[0].geometry.userData.targetNames.length)}),t}changeIconFile(e){const t=new Image;t.onload=e=>{Promise.resolve(createImageBitmap(t)).then(e=>{this.meta&&(this.meta.texture||(this.meta.texture=new V["Texture"]),this.meta.texture.image=e)})},t.src=e}};Object(S["a"])([Object(T["c"])()],ie.prototype,"meta",void 0),Object(S["a"])([Object(T["c"])()],ie.prototype,"vrmObject",void 0),Object(S["a"])([Object(T["c"])()],ie.prototype,"exporterVersion",void 0),ie=Object(S["a"])([Object(T["a"])({components:{ImageBitmapImg:J,DragAndDroppableArea:ne}})],ie);var oe=ie,se=oe,le=(r("dc9f"),r("1f4f")),ce=Object(u["a"])(se,G,F,!1,null,null,null),ue=ce.exports;p()(ce,{VSimpleTable:le["a"]});var me=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.materials?r("div",e._l(e.toUniqueMaterialInfos(e.materials),(function(t,a){return r("div",{key:a},[r("v-card",{staticClass:"card",attrs:{dark:""}},[r("v-list-item",{attrs:{"three-line":""}},[r("v-list-item-content",[r("v-list-item-title",{staticClass:"headline"},[e._v(" "+e._s(t.material.name)+" ")]),r("v-list-item-subtitle",[e._v(" "+e._s(t.material.userData.vrmMaterialProperties.shader)+" ")]),r("v-list-item-subtitle",[0===t.material.side?r("div",[e._v("FrontSide")]):1===t.material.side?r("div",[e._v("BackSide")]):r("div",[e._v("BothSide")])])],1),t.material.color?r("v-list-item-avatar",{attrs:{size:"80",color:e.convertRGB2Hex(t.material.color)}}):e._e(),t.material.map&&t.material.map.image?r("ImageBitmapImg",{attrs:{imageBitmap:t.material.map.image}}):e._e()],1)],1)],1)})),0):e._e()},pe=[];let de=class extends T["e"]{convertRGB2Hex(e){const t=Math.round(255*Number(e.x)),r=Math.round(255*Number(e.y)),a=Math.round(255*Number(e.z));return"#"+t.toString(16)+r.toString(16)+a.toString(16)}toUniqueMaterialInfos(e){const t=Array();for(let r=0;r<e.length;r++){const a=t.map(e=>e.name).indexOf(e[r].name);-1===a?t.push({name:e[r].name,material:e[r],indices:[r]}):t[a].indices.push(r)}return t}};Object(S["a"])([Object(T["c"])()],de.prototype,"materials",void 0),Object(S["a"])([Object(T["c"])()],de.prototype,"uniqueMaterialInfos",void 0),de=Object(S["a"])([Object(T["a"])({components:{ImageBitmapImg:J}})],de);var he=de,fe=he,ve=(r("9dd2"),r("b0af")),ge=r("da13"),be=r("5d23"),ye=Object(u["a"])(fe,me,pe,!1,null,null,null),Oe=ye.exports;p()(ye,{VCard:ve["a"],VListItem:ge["a"],VListItemAvatar:K["a"],VListItemContent:be["a"],VListItemSubtitle:be["b"],VListItemTitle:be["c"]});var _e=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.vrmObject?r("div",[r("v-simple-table",[r("tbody",[null!==e.vrmObject.children?r("tr",[r("td",[e._v("Mesh Count")]),r("td",[e._v(e._s(e.getMeshCount(e.vrmObject.children)))]),r("td")]):e._e(),null!==e.materials?r("tr",[r("td",[e._v("SubMesh Count")]),r("td",[e._v(e._s(e.materials.length))]),r("td")]):e._e(),null!==e.vrmObject.children?r("tr",[r("td",[e._v("Polygon Count")]),r("td",[e._v(e._s(e.getPolygonCount(e.vrmObject.children)))]),r("td")]):e._e(),null!==e.vrmObject.children?r("tr",[r("td",[e._v("Bone Count")]),r("td",[e._v(e._s(e.getBoneCount(e.vrmObject.children)))]),r("td",[r("ShowBoneButton")],1)]):e._e(),null!==e.vrmObject.children?r("tr",[r("td",[e._v("BlendShape Count")]),r("td",[e._v(e._s(e.getBlendShapeCount(e.vrmObject.children)))]),r("td")]):e._e()])])],1):e._e()},we=[],xe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-btn",{on:{click:function(t){e.isShowing?e.hideBone():e.showBone()}}},[e.isShowing?r("div",[e._v("Hide")]):r("div",[e._v("Show")])])},je=[];let Ie=class extends T["e"]{showBone(){if(!this.vrmObject||!this.scene||this.isShowing)return;const e=this.vrmObject.children.filter(e=>e.children.length>0&&"Bone"===e.children[0].type)[0];this.boneObject=this.generateBoneSupporter(e),this.scene.add(this.boneObject),this.isShowing=!0}hideBone(){this.boneObject&&this.scene&&this.isShowing&&(this.scene.remove(this.boneObject),this.isShowing=!1)}generateBoneSupporter(e,t,r){r||(r=new V["LineBasicMaterial"]({color:16711680,transparent:!0,depthWrite:!1,depthTest:!1}));const a=new V["Geometry"];t&&a.vertices.push(t.getWorldPosition(new V["Vector3"](0,0,0)),e.getWorldPosition(new V["Vector3"](0,0,0)));const n=new V["Line"](a,r);return n.name=e.name,e.children.forEach(t=>{n.children.push(this.generateBoneSupporter(t,e,r))}),n}};Object(S["a"])([Object(T["b"])("vrmObject")],Ie.prototype,"vrmObject",void 0),Object(S["a"])([Object(T["b"])("scene")],Ie.prototype,"scene",void 0),Object(S["a"])([Object(T["c"])({default:!1})],Ie.prototype,"isShowing",void 0),Ie=Object(S["a"])([T["a"]],Ie);var Ne=Ie,Ee=Ne,Se=r("8336"),Te=Object(u["a"])(Ee,xe,je,!1,null,null,null),Me=Te.exports;p()(Te,{VBtn:Se["a"]});let Ae=class extends T["e"]{getMeshCount(e){return e.filter(e=>["Group","SkinnedMesh"].includes(e.type)).length}getPolygonCount(e){return e.filter(e=>["Group","SkinnedMesh"].includes(e.type)).map(e=>"Group"===e.type?e.children[0].geometry.attributes.position.count:e.geometry.attributes.position.count).reduce((e,t)=>e+t,0)}getBoneCount(e){return this.getChildrenCount(e.filter(e=>e.children.length>0&&"Bone"===e.children[0].type)[0])}getChildrenCount(e){return 0===e.children.length?0:e.children.map(e=>this.getChildrenCount(e)).reduce((e,t)=>e+t,0)+e.children.length}getBlendShapeCount(e){let t=0;return e.forEach(e=>{if("Group"===e.type){const r=e.children[0].geometry.userData;t+=r.targetNames?r.targetNames.length:0}else if("SkinnedMesh"===e.type){const r=e.geometry.userData;t+=r.targetNames?r.targetNames.length:0}}),t}};Object(S["a"])([Object(T["c"])()],Ae.prototype,"materials",void 0),Object(S["a"])([Object(T["c"])()],Ae.prototype,"vrmObject",void 0),Ae=Object(S["a"])([Object(T["a"])({components:{ShowBoneButton:Me}})],Ae);var De=Ae,Be=De,Ve=Object(u["a"])(Be,_e,we,!1,null,null,null),Re=Ve.exports;p()(Ve,{VSimpleTable:le["a"]});var Ce,Le=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-btn",{attrs:{block:"",color:"primary",disabled:null===e.vrm},on:{click:e.exportVRM}},[e._v(" Export VRM (beta) ")])},Ue=[];function Pe(e,t,r){return{allowedUserName:e.allowedUserName,author:e.author,commercialUssageName:e.commercialUssageName,contactInformation:e.contactInformation,licenseName:e.licenseName,otherLicenseUrl:e.otherLicenseUrl,otherPermissionUrl:e.otherPermissionUrl,reference:e.reference,sexualUssageName:e.sexualUssageName,texture:t?r.length-1:void 0,title:e.title,version:e.version,violentUssageName:e.violentUssageName}}(function(e){e[e["ARRAY_BUFFER"]=34962]="ARRAY_BUFFER",e[e["ELEMENT_ARRAY_BUFFER"]=34963]="ELEMENT_ARRAY_BUFFER",e[e["BYTE"]=5120]="BYTE",e[e["UNSIGNED_BYTE"]=5121]="UNSIGNED_BYTE",e[e["SHORT"]=5122]="SHORT",e[e["UNSIGNED_SHORT"]=5123]="UNSIGNED_SHORT",e[e["UNSIGNED_INT"]=5125]="UNSIGNED_INT",e[e["FLOAT"]=5126]="FLOAT",e[e["LINEAR"]=9729]="LINEAR",e[e["REPEAT"]=10497]="REPEAT"})(Ce||(Ce={}));const ke="blend_",Ge="BlendShapeController_",Fe="vrmColliderSphere",He="UniVRM-0.64.0";class ze{parse(e,t){const r=e.scene,a=e.humanoid,n=e.meta,i=e.materials,o=e.blendShapeProxy,s=e.lookAt,l=e.springBoneManager,c={generator:"UniGLTF-2.0.0",version:"2.0"};if(!r)throw new Error("scene is undefined or null");if(!a)throw new Error("humanoid is undefined or null");if(!n)throw new Error("meta is undefined or null");if(!i)throw new Error("materials is undefined or null");if(!o)throw new Error("blendShapeProxy is undefined or null");if(!s)throw new Error("lookAt is undefined or null");if(!l)throw new Error("springBone is undefined or null");const u=i.filter((e,t,r)=>r.findIndex(t=>t.name===e.name)===t).map(e=>e),m=u.map(e=>e.name),p=n.texture?{name:"icon",imageBitmap:n.texture.image}:null,d=u.filter(e=>e.map).map(e=>{if(!e.map)throw new Error(e.name+" map is null");return{name:e.name,imageBitmap:e.map.image}}),h=st(d,p),f=lt(h),v=ct(h),g=ot(u,d),b=r.children.filter(e=>e.children.length>0&&e.children[0].type===at.Bone)[0],y=Xe(b).filter(e=>e.name!==Fe),O=y.map(e=>e.name),_=y.map(e=>({children:e.children.filter(e=>e.name!==Fe).map(e=>O.indexOf(e.name)),name:e.name,rotation:[e.quaternion.x,e.quaternion.y,e.quaternion.z,e.quaternion.w],scale:[e.scale.x,e.scale.y,e.scale.z],translation:[e.position.x,e.position.y,e.position.z]})),w=[],x=r.children.filter(e=>e.type===at.Group||e.type===at.SkinnedMesh),j=[];x.forEach(e=>{const t=e.type===at.Group?e.children[0]:e,r=t.geometry.attributes;j.push(new Ze(r.position,Ce.FLOAT,rt.POSITION,tt.VEC3,t.name,void 0)),j.push(new Ze(r.normal,Ce.FLOAT,rt.NORMAL,tt.VEC3,t.name,void 0)),j.push(new Ze(r.uv,Ce.FLOAT,rt.UV,tt.VEC2,t.name,void 0)),j.push(new Ze(r.skinWeight,Ce.FLOAT,rt.SKIN_WEIGHT,tt.VEC4,t.name,void 0)),j.push(new Ze(r.skinIndex,Ce.UNSIGNED_SHORT,rt.SKIN_INDEX,tt.VEC4,t.name,void 0));const a=e.type===at.Group?e.children.map(e=>e):[e];if(a.forEach(e=>{if(!e.geometry.index)throw new Error(e.name+" geometry.index is null");j.push(new Ze(e.geometry.index,Ce.UNSIGNED_INT,rt.INDEX,tt.SCALAR,t.name,e.name))}),!t.morphTargetDictionary)throw new Error(t.name+" morphTargetDictionary is null");const n=Object.entries(t.morphTargetDictionary);t.geometry.userData.targetNames&&t.geometry.userData.targetNames.forEach(e=>{const r=n.filter(t=>t[0]===e)[0][1],a=t.geometry.morphAttributes;j.push(new Ze(a.position[r],Ce.FLOAT,rt.BLEND_POSITION,tt.VEC3,t.name,ke+e)),j.push(new Ze(a.normal[r],Ce.FLOAT,rt.BLEND_NORMAL,tt.VEC3,t.name,ke+e))})}),x.forEach(e=>{const t=e.type===at.Group?e.children[0]:e,r=new Float32Array(t.skeleton.boneInverses.map(e=>e.elements).flat());j.push(new Ze(new V["BufferAttribute"](r,16),Ce.FLOAT,rt.BIND_MATRIX,tt.MAT4,t.name,t.name))}),w.push(...j.map(e=>({bufferView:-1,byteOffset:0,componentType:e.valueType,count:e.attribute.count,max:e.max,min:e.min,normalized:!1,type:e.accessorsType})));const I=nt(x,j,m);x.forEach((e,t)=>{_.push({mesh:t,name:e.name,rotation:[e.quaternion.x,e.quaternion.y,e.quaternion.z,e.quaternion.w],scale:[e.scale.x,e.scale.y,e.scale.z],skin:t,translation:[e.position.x,e.position.y,e.position.z]})});const N=r.children.filter(e=>"secondary"===e.name)[0];_.push({name:N.name,rotation:[N.quaternion.x,N.quaternion.y,N.quaternion.z,N.quaternion.w],scale:[N.scale.x,N.scale.y,N.scale.z],translation:[N.position.x,N.position.y,N.position.z]});const E=it(x,j,O),S={blendShapeGroups:Object.values(o._blendShapeGroups).map(e=>({binds:e._binds.map(e=>({index:e.morphTargetIndex,mesh:I.map(e=>e.name).indexOf(e.meshes[0].name),weight:100*e.weight})),isBinary:e.isBinary,materialValues:e._materialValues,name:e.name.replace(Ge,""),presetName:Object.entries(o.blendShapePresetMap).filter(t=>t[1]===e.name.replace(Ge,""))[0][0]}))};s.firstPerson._firstPersonBoneOffset.z*=-1;const T={firstPersonBone:O.indexOf(s.firstPerson._firstPersonBone.name),firstPersonBoneOffset:s.firstPerson._firstPersonBoneOffset,lookAtHorizontalInner:{curve:s.applyer._curveHorizontalInner.curve,xRange:qe(s.applyer._curveHorizontalInner.curveXRangeDegree),yRange:qe(s.applyer._curveHorizontalInner.curveYRangeDegree)},lookAtHorizontalOuter:{curve:s.applyer._curveHorizontalOuter.curve,xRange:qe(s.applyer._curveHorizontalOuter.curveXRangeDegree),yRange:qe(s.applyer._curveHorizontalOuter.curveYRangeDegree)},lookAtTypeName:s.applyer.type,lookAtVerticalDown:{curve:s.applyer._curveVerticalDown.curve,xRange:qe(s.applyer._curveVerticalDown.curveXRangeDegree),yRange:qe(s.applyer._curveVerticalDown.curveYRangeDegree)},lookAtVerticalUp:{curve:s.applyer._curveVerticalUp.curve,xRange:qe(s.applyer._curveVerticalUp.curveXRangeDegree),yRange:qe(s.applyer._curveVerticalUp.curveYRangeDegree)},meshAnnotations:s.firstPerson.meshAnnotations.map(e=>({firstPersonFlag:0===e.firstPersonFlag?"Auto":"",mesh:I.map(e=>e.name).indexOf(e.mesh.children.length>0?e.mesh.children[0].name:e.mesh.name)}))},M={armStretch:a.humanDescription.armStretch,feetSpacing:a.humanDescription.feetSpacing,hasTranslationDoF:a.humanDescription.hasTranslationDoF,humanBones:Object.entries(a.humanBones).filter(e=>e[1].length>0).map(e=>({bone:e[0],node:O.indexOf(e[1][0].node.name),useDefaultValues:!0})),legStretch:a.humanDescription.legStretch,lowerArmTwist:a.humanDescription.lowerArmTwist,lowerLegTwist:a.humanDescription.lowerLegTwist,upperArmTwist:a.humanDescription.upperArmTwist,upperLegTwist:a.humanDescription.upperLegTwist},A=i.map(e=>e.userData.vrmMaterialProperties),D=Pe(n,p,h),B=mt(l,O),R=[];R.push(...d.map(e=>({buffer:We(e.imageBitmap),type:rt.IMAGE}))),R.push(...j.map(e=>({buffer:e.buffer,type:e.type}))),p&&R.push({buffer:We(p.imageBitmap),type:rt.IMAGE});let C=0,L=0,U=0;const P=R.map((e,t)=>{const r={buffer:0,byteLength:e.buffer.byteLength,byteOffset:C,target:e.type===rt.IMAGE||e.type===rt.BIND_MATRIX?void 0:e.type===rt.INDEX?Ce.ELEMENT_ARRAY_BUFFER:Ce.ARRAY_BUFFER};return C+=e.buffer.byteLength,e.type===rt.IMAGE?h[L++].bufferView=t:w[U++].bufferView=t,r}),k=ut(r,_),G={accessors:w,asset:c,buffers:[{byteLength:C}],bufferViews:P,extensions:{VRM:{blendShapeMaster:S,exporterVersion:He,firstPerson:T,humanoid:M,materialProperties:A,meta:D,secondaryAnimation:B,specVersion:"0.0"}},extensionsUsed:["KHR_materials_unlit","KHR_texture_transform","VRM"],images:h,materials:g,meshes:I,nodes:_,samplers:f,scene:0,scenes:k,skins:E,textures:v},F=new Qe(Ke(JSON.stringify(G,void 0,2)),"JSON"),H=new Qe($e(R.map(e=>e.buffer)),"BIN\0"),z=$e([F.buffer,H.buffer]),q=$e([Ke("glTF"),Ye(2,4),Ye(z.byteLength+12,4)]);t($e([q,z]))}}function qe(e){return e*(180/Math.PI)}function Xe(e){return e.children.length<=0?[e]:[e].concat(e.children.map(e=>Xe(e)).flat())}function We(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0);const r=t.toDataURL("image/png"),a=atob(r.split(",")[1]),n=new ArrayBuffer(a.length),i=new DataView(n);for(let o=0;o<a.length;o++)i.setUint8(o,a.charCodeAt(o));return n}function Ye(e,t){const r=new ArrayBuffer(t),a=new DataView(r);return a.setUint32(0,e,!0),r}function Ke(e){return(new TextEncoder).encode(e).buffer}function $e(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n].byteLength;const r=new Uint8Array(t);let a=0;for(let n=0;n<e.length;++n)r.set(new Uint8Array(e[n]),a),a+=e[n].byteLength;return r.buffer}function Je(e,t){const r=t===Ce.UNSIGNED_SHORT?2:4,a=e.array;let n=0;const i=new ArrayBuffer(e.count*e.itemSize*r),o=new DataView(i);for(let s=0;s<e.count;s++)for(let i=0;i<e.itemSize;i++){let l;l=e.itemSize>4?a[s*e.itemSize+i]:0===i?e.getX(s):1===i?e.getY(s):2===i?e.getZ(s):e.getW(s),t===Ce.UNSIGNED_SHORT?o.setUint16(n,l,!0):t===Ce.UNSIGNED_INT?o.setUint32(n,l,!0):o.setFloat32(n,l,!0),n+=r}return i}class Qe{constructor(e,t){this.data=e,this.type=t;const r=this.data;this.buffer=$e([Ye(r.byteLength,4),Ke(this.type),r])}paddingBinary(e,t){const r=4*Math.ceil(e.byteLength/4);if(e.byteLength===r)return e;const a=new Uint8Array(r);a.set(new Uint8Array(e),0);for(let n=e.byteLength;n<r;n++)a.set(new Uint8Array(t),n);return a.buffer}}class Ze{constructor(e,t,r,a,n,i){this.attribute=e,this.type=r,this.valueType=t,this.accessorsType=a,this.meshName=n,this.name=i,this.buffer=Je(this.attribute,this.valueType),this.max=r===rt.POSITION||r===rt.BLEND_POSITION?[Math.max.apply(null,Array.from(this.attribute.array).filter((e,t)=>t%3===0)),Math.max.apply(null,Array.from(this.attribute.array).filter((e,t)=>t%3===1)),Math.max.apply(null,Array.from(this.attribute.array).filter((e,t)=>t%3===2))]:void 0,this.min=r===rt.POSITION||r===rt.BLEND_POSITION?[Math.min.apply(null,Array.from(this.attribute.array).filter((e,t)=>t%3===0)),Math.min.apply(null,Array.from(this.attribute.array).filter((e,t)=>t%3===1)),Math.min.apply(null,Array.from(this.attribute.array).filter((e,t)=>t%3===2))]:void 0}}var et,tt,rt,at;(function(e){e["MeshBasicMaterial"]="MeshBasicMaterial",e["MeshStandardMaterial"]="MeshStandardMaterial",e["MToonMaterial"]="MToonMaterial"})(et||(et={})),function(e){e["SCALAR"]="SCALAR",e["VEC2"]="VEC2",e["VEC3"]="VEC3",e["VEC4"]="VEC4",e["MAT4"]="MAT4"}(tt||(tt={})),function(e){e["POSITION"]="POSITION",e["NORMAL"]="NORMAL",e["UV"]="UV",e["INDEX"]="INDEX",e["SKIN_WEIGHT"]="SKIN_WEIGHT",e["SKIN_INDEX"]="SKIN_INDEX",e["BLEND_POSITION"]="BLEND_POSITION",e["BLEND_NORMAL"]="BLEND_NORMAL",e["BIND_MATRIX"]="BIND_MATRIX",e["IMAGE"]="IMAGE"}(rt||(rt={})),function(e){e["Group"]="Group",e["SkinnedMesh"]="SkinnedMesh",e["Object3D"]="Object3D",e["Bone"]="Bone"}(at||(at={}));const nt=(e,t,r)=>e.map(e=>{const a=e.type===at.Group?e.children[0]:e,n=e.type===at.Group?e.children.map(e=>e):[e];return{extras:{targetNames:a.geometry.userData.targetNames},name:a.name,primitives:n.map(e=>{const n=t.map(e=>e.meshName===a.name?e.type:null),i=Array.isArray(e.material)?e.material[0].name:e.material.name;return{attributes:{JOINTS_0:n.indexOf(rt.SKIN_INDEX),NORMAL:n.indexOf(rt.NORMAL),POSITION:n.indexOf(rt.POSITION),TEXCOORD_0:n.indexOf(rt.UV),WEIGHTS_0:n.indexOf(rt.SKIN_WEIGHT)},extras:{targetNames:e.geometry.userData.targetNames},indices:t.map(e=>e.type===rt.INDEX&&e.meshName===a.name?e.name:null).indexOf(e.name),material:r.indexOf(i),mode:4,targets:a.geometry.userData.targetNames?a.geometry.userData.targetNames.map(e=>({NORMAL:t.map(e=>e.type===rt.BLEND_NORMAL&&e.meshName===a.name?e.name:null).indexOf(ke+e),POSITION:t.map(e=>e.type===rt.BLEND_POSITION&&e.meshName===a.name?e.name:null).indexOf(ke+e)})):void 0}})}}),it=(e,t,r)=>e.map(e=>{const a=e.type===at.Group?e.children[0]:e;return{inverseBindMatrices:t.map(e=>e.type===rt.BIND_MATRIX?e.meshName:null).indexOf(a.name),joints:a.skeleton.bones.map(e=>r.indexOf(e.name)),skeleton:r.indexOf(a.skeleton.bones[0].name)}}),ot=(e,t)=>e.map(e=>{let r;if(e.type===et.MToonMaterial){const t=e;r=t.color?[t.color.x,t.color.y,t.color.z,t.color.w]:void 0}else{const t=e;r=t.color?[t.color.r,t.color.g,t.color.b,1]:void 0}const a=e.map?{extensions:{KHR_texture_transform:{offset:[0,0],scale:[1,1]}},index:t.map(e=>e.name).indexOf(e.name),texCoord:0}:void 0,n=(()=>{switch(e.type){case et.MeshStandardMaterial:return e.metalness;case et.MeshBasicMaterial:return 0;default:return.5}})(),i=(()=>{switch(e.type){case et.MeshStandardMaterial:return e.roughness;case et.MeshBasicMaterial:return.9;default:return.5}})();return{alphaCutoff:e.alphaTest>0?e.alphaTest:void 0,alphaMode:e.transparent?"BLEND":e.alphaTest>0?"MASK":"OPAQUE",doubleSided:2===e.side,extensions:e.type===et.MeshBasicMaterial?{KHR_materials_unlit:{}}:void 0,name:e.name,pbrMetallicRoughness:{baseColorFactor:r,baseColorTexture:a,metallicFactor:n,roughnessFactor:i}}}),st=(e,t)=>(t?e.concat(t):e).filter(e=>e&&e.imageBitmap).map(e=>({bufferView:-1,mimeType:"image/png",name:e.name})),lt=e=>e.map(()=>({magFilter:Ce.LINEAR,minFilter:Ce.LINEAR,wrapS:Ce.REPEAT,wrapT:Ce.REPEAT})),ct=e=>e.map((e,t)=>({sampler:t,source:t})),ut=(e,t)=>{const r=t.map(e=>e.name);return[{nodes:e.children.filter(e=>e.type===at.Object3D||e.type===at.SkinnedMesh||e.type===at.Group).map(e=>r.indexOf(e.name))}]},mt=(e,t)=>({boneGroups:e.springBoneGroupList[0]&&e.springBoneGroupList[0].length>0?e.springBoneGroupList.map(r=>({bones:r.map(e=>t.indexOf(e.bone.name)),center:r[0].center?t.indexOf(r[0].center.name):-1,colliderGroups:e.colliderGroups.map((e,t)=>t),dragForce:r[0].dragForce,gravityDir:{x:r[0].gravityDir.x,y:r[0].gravityDir.y,z:r[0].gravityDir.z},gravityPower:r[0].gravityPower,hitRadius:r[0].radius,stiffiness:r[0].stiffnessForce})):[{bones:[],center:-1,colliderGroups:[],dragForce:.4,gravityDir:{x:0,y:-1,z:0},gravityPower:0,hitRadius:.02,stiffiness:1}],colliderGroups:e.colliderGroups.map(e=>({colliders:[{offset:{x:e.colliders[0].position.x,y:e.colliders[0].position.y,z:e.colliders[0].position.z},radius:e.colliders[0].geometry.boundingSphere?e.colliders[0].geometry.boundingSphere.radius:void 0}],node:e.node}))});let pt=class extends T["e"]{exportVRM(){if(!this.vrm)return;const e=new ze;e.parse(this.vrm,e=>{const t="test.vrm",r=new Blob([e],{type:"octet/stream"}),a=document.createElement("a");a.href=URL.createObjectURL(r),a.download=t,a.click()})}};Object(S["a"])([Object(T["c"])()],pt.prototype,"vrm",void 0),pt=Object(S["a"])([T["a"]],pt);var dt=pt,ht=dt,ft=Object(u["a"])(ht,Le,Ue,!1,null,null,null),vt=ft.exports;p()(ft,{VBtn:Se["a"]});let gt=class extends T["e"]{constructor(){super(...arguments),this.vrmObject=null}onFileChange(e){if(null===e.target.files)return;const t=e.target.files[0],r=window.URL.createObjectURL(t);this.loadVrm(r)}loadVrm(e){const t=new M["a"];t.load(e,e=>{console.log(e);const t=e.userData.gltfExtensions.VRM;this.exporterVersion=t.exporterVersion?t.exporterVersion:"UniVRM-"+t.version,console.log(this.exporterVersion),A["VRM"].from(e).then(e=>{this.vrm=e,this.meta=e.meta,this.materials=e.materials,this.vrmObject=e.scene,console.log(e)})},e=>console.log("Loading model...",e.loaded/e.total*100,"%"),e=>console.error(e))}changeTab(e){this.currentTab=e}reloadPage(){location.reload()}};Object(S["a"])([Object(T["c"])()],gt.prototype,"vrm",void 0),Object(S["a"])([Object(T["c"])()],gt.prototype,"meta",void 0),Object(S["a"])([Object(T["c"])()],gt.prototype,"materials",void 0),Object(S["a"])([Object(T["d"])("vrmObject")],gt.prototype,"vrmObject",void 0),Object(S["a"])([Object(T["c"])()],gt.prototype,"exporterVersion",void 0),Object(S["a"])([Object(T["c"])({default:0})],gt.prototype,"currentTab",void 0),gt=Object(S["a"])([Object(T["a"])({components:{VRMCanvas:k,MetaView:ue,MaterialView:Oe,ModelInfoView:Re,ExportButton:vt,DragAndDroppableArea:ne}})],gt);var bt=gt,yt=bt,Ot=(r("cccb"),r("40dc")),_t=r("132d"),wt=r("2fa4"),xt=r("71a3"),jt=r("fe57"),It=r("2a7f"),Nt=Object(u["a"])(yt,N,E,!1,null,null,null),Et=Nt.exports;p()(Nt,{VAppBar:Ot["a"],VBtn:Se["a"],VCard:ve["a"],VIcon:_t["a"],VSpacer:wt["a"],VTab:xt["a"],VTabs:jt["a"],VToolbarTitle:It["a"]}),a["a"].use(I["a"]);const St=[{path:"/",name:"Home",component:Et},{path:"/about",name:"About",component:()=>r.e("about").then(r.bind(null,"f820"))}],Tt=new I["a"]({mode:"history",base:"/vrm-avatar-editor/",routes:St});var Mt=Tt,At=r("2f62");a["a"].use(At["a"]);var Dt=new At["a"].Store({state:{},mutations:{},actions:{},modules:{}}),Bt=r("f309");a["a"].use(Bt["a"]);var Vt=new Bt["a"]({});a["a"].config.productionTip=!1,new a["a"]({router:Mt,store:Dt,vuetify:Vt,render:e=>e(j)}).$mount("#app")},dc9f:function(e,t,r){"use strict";r("0bc1")}});
//# sourceMappingURL=app.e31609c3.js.map